
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>WildBoottest - wildboottest</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wildboottest.wildboottest.Wildboottest" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="wildboottest" class="md-header__button md-logo" aria-label="wildboottest" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            wildboottest
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WildBoottest
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/s3alfisc/wildboottest" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    s3alfisc/wildboottest
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      WildBoottest
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../weights/" class="md-tabs__link">
      Weighting
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../library_apis/" class="md-tabs__link">
      Library APIs
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="wildboottest" class="md-nav__button md-logo" aria-label="wildboottest" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    wildboottest
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/s3alfisc/wildboottest" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    s3alfisc/wildboottest
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          WildBoottest
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        WildBoottest
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest" class="md-nav__link">
    wildboottest.wildboottest.Wildboottest
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest.get_scores" class="md-nav__link">
    get_scores()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest.get_weights" class="md-nav__link">
    get_weights()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../weights/" class="md-nav__link">
        Weighting
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../library_apis/" class="md-nav__link">
        Library APIs
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest" class="md-nav__link">
    wildboottest.wildboottest.Wildboottest
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest.get_scores" class="md-nav__link">
    get_scores()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wildboottest.wildboottest.Wildboottest.get_weights" class="md-nav__link">
    get_weights()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/s3alfisc/wildboottest/edit/master/docs/base.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>WildBoottest</h1>

<div class="doc doc-object doc-class">

<a id="wildboottest.wildboottest.Wildboottest"></a>
    <div class="doc doc-contents first">

      <p>Create an object of Wildboottest and get p-value by successively applying
methods in the following way: </p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">wildboottest.wildboottest</span> <span class="kn">import</span> <span class="n">Wildboottest</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12312312</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">G</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">X</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">u</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">G</span><span class="p">)),</span> <span class="n">N</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">999</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span> <span class="o">=</span> <span class="n">Wildboottest</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_scores</span><span class="p">(</span><span class="n">bootstrap_type</span> <span class="o">=</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="n">impose_null</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(</span><span class="n">weights_type</span><span class="o">=</span> <span class="s2">&quot;rademacher&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_numer</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_denom</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_tboot</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_vcov</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_tstat</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">wb</span><span class="o">.</span><span class="n">get_pvalue</span><span class="p">()</span>  
</code></pre></div>

        <details class="quote">
          <summary>Source code in <code>wildboottest/wildboottest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Wildboottest</span><span class="p">:</span> 
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Create an object of Wildboottest and get p-value by successively applying</span>
<span class="sd">  methods in the following way: </span>

<span class="sd">  Example:</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from wildboottest.wildboottest import Wildboottest</span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(12312312)</span>
<span class="sd">    &gt;&gt;&gt; N = 1000</span>
<span class="sd">    &gt;&gt;&gt; k = 3</span>
<span class="sd">    &gt;&gt;&gt; G = 10</span>
<span class="sd">    &gt;&gt;&gt; X = np.random.normal(0, 1, N * k).reshape((N,k))</span>
<span class="sd">    &gt;&gt;&gt; beta = np.random.normal(0,1,k)</span>
<span class="sd">    &gt;&gt;&gt; beta[0] = 0.005</span>
<span class="sd">    &gt;&gt;&gt; u = np.random.normal(0,1,N)</span>
<span class="sd">    &gt;&gt;&gt; Y = 1 + X @ beta + u</span>
<span class="sd">    &gt;&gt;&gt; cluster = np.random.choice(list(range(0,G)), N)</span>
<span class="sd">    &gt;&gt;&gt; R = np.array([1, 0, 0])</span>
<span class="sd">    &gt;&gt;&gt; B = 999</span>

<span class="sd">    &gt;&gt;&gt; wb = Wildboottest(X = X, Y = Y, cluster = cluster, R = R, B = B)</span>
<span class="sd">    &gt;&gt;&gt; wb.get_scores(bootstrap_type = &quot;11&quot;, impose_null = True)</span>
<span class="sd">    &gt;&gt;&gt; wb.get_weights(weights_type= &quot;rademacher&quot;)</span>
<span class="sd">    &gt;&gt;&gt; wb.get_numer()</span>
<span class="sd">    &gt;&gt;&gt; wb.get_denom()</span>
<span class="sd">    &gt;&gt;&gt; wb.get_tboot()</span>
<span class="sd">    &gt;&gt;&gt; wb.get_vcov()</span>
<span class="sd">    &gt;&gt;&gt; wb.get_tstat()</span>
<span class="sd">    &gt;&gt;&gt; wb.get_pvalue()  </span>

<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> 
               <span class="n">Y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> 
               <span class="n">cluster</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> 
               <span class="n">R</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
               <span class="n">B</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
               <span class="n">bootcluster</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
               <span class="n">seed</span><span class="p">:</span>  <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Initializes the Wild Cluster Bootstrap Class</span>

<span class="sd">    Args:</span>
<span class="sd">        X (Union[np.ndarray, pd.DataFrame, pd.Series]): Exogeneous variable array or dataframe</span>
<span class="sd">        Y (Union[np.ndarray, pd.DataFrame, pd.Series]): Endogenous variable array or dataframe</span>
<span class="sd">        cluster (Union[np.ndarray, pd.DataFrame, pd.Series]): Cluster array or dataframe</span>
<span class="sd">        R (Union[np.ndarray, pd.DataFrame]): Constraint matrix for running bootstrap</span>
<span class="sd">        B (int): bootstrap iterations</span>
<span class="sd">        bootcluster (Union[np.ndarray, pd.DataFrame, pd.Series, None], optional): Sub-cluster array. Defaults to None.</span>
<span class="sd">        seed (Union[int, None], optional): Random seed for random weight types. Defaults to None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Raise if input arrays are lists</span>
<span class="sd">        TestMatrixNonConformabilityException: Raise if constraint matrix shape does not conform to X</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="s2">&quot;Initialize the wildboottest class&quot;</span>
    <span class="c1">#assert bootstrap_type in [&#39;11&#39;, &#39;13&#39;, &#39;31&#39;, &#39;33&#39;]</span>
    <span class="c1">#assert impose_null in [True, False]</span>

    <span class="k">if</span> <span class="n">bootcluster</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
      <span class="n">bootcluster</span> <span class="o">=</span> <span class="n">cluster</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">bootcluster</span><span class="p">]:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> cannot be a list&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">clustid</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bootcluster</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span> <span class="o">=</span> <span class="n">bootcluster</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">=</span> <span class="n">bootcluster</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">clustid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">bootcluster</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">=</span> <span class="n">bootcluster</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
      <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">N_G_bootcluster</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">G</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clustid</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="n">TestMatrixNonConformabilityException</span><span class="p">(</span><span class="s2">&quot;The number of rows in the test matrix R, does not &quot;</span><span class="p">)</span>

    <span class="n">X_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tXgXg_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tXgyg_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tXX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
    <span class="n">tXy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

    <span class="c1">#all_cluster = np.unique(bootcluster)</span>

    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">:</span>

      <span class="c1"># split X and Y by (boot)cluster</span>
      <span class="n">X_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">==</span> <span class="n">g</span><span class="p">)]</span>
      <span class="n">Y_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">==</span> <span class="n">g</span><span class="p">)]</span>
      <span class="n">tXgXg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X_g</span><span class="p">)</span> <span class="o">@</span> <span class="n">X_g</span>
      <span class="n">tXgyg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X_g</span><span class="p">)</span> <span class="o">@</span> <span class="n">Y_g</span>
      <span class="n">X_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_g</span><span class="p">)</span>
      <span class="n">y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_g</span><span class="p">)</span>
      <span class="n">tXgXg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tXgXg</span><span class="p">)</span>
      <span class="n">tXgyg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tXgyg</span><span class="p">)</span>
      <span class="n">tXX</span> <span class="o">=</span> <span class="n">tXX</span> <span class="o">+</span> <span class="n">tXgXg</span>
      <span class="n">tXy</span> <span class="o">=</span> <span class="n">tXy</span> <span class="o">+</span> <span class="n">tXgyg</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">X_list</span> <span class="o">=</span> <span class="n">X_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Y_list</span> <span class="o">=</span> <span class="n">y_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span> <span class="o">=</span> <span class="n">tXgXg_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span> <span class="o">=</span> <span class="n">tXgyg_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tXX</span> <span class="o">=</span> <span class="n">tXX</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tXy</span> <span class="o">=</span> <span class="n">tXy</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">tXX</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RtXXinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Function for getting weights for bootstrapping.</span>

<span class="sd">    Args:</span>
<span class="sd">        weights_type (Tuple[str, Callable]): The distribution to be used. Accepts Either &#39;rademacher&#39;, &#39;mammen&#39;, &#39;norm&#39; or &#39;webb&#39;. Optionally accepts a callable of one argument, `n`, the number of bootstraps iterations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, int]: Returns the arrays of weights and the number of bootstrap iterations</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="bp">self</span><span class="o">.</span><span class="n">weights_type</span> <span class="o">=</span> <span class="n">weights_type</span> 

    <span class="k">if</span> <span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">N_G_bootcluster</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="ow">and</span> <span class="n">weights_type</span><span class="o">==</span><span class="s1">&#39;rademacher&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">full_enumeration</span> <span class="o">=</span> <span class="kc">True</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;2^G &lt; the number of boot iterations, setting full_enumeration to True.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">full_enumeration</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">draw_weights</span><span class="p">(</span>
      <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_type</span><span class="p">,</span> 
      <span class="n">full_enumeration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_enumeration</span><span class="p">,</span> 
      <span class="n">N_G_bootcluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_G_bootcluster</span><span class="p">,</span>
      <span class="n">boot_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>
    <span class="p">)</span>  

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>

  <span class="k">def</span> <span class="nf">get_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bootstrap_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                 <span class="n">impose_null</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">adj</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                 <span class="n">cluster_adj</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Run bootstrap and get scores for each variable</span>

<span class="sd">    Args:</span>
<span class="sd">        bootstrap_type (str): Determines which wild cluster bootstrap type should be run. Options are &quot;fnw11&quot;,&quot;11&quot;, &quot;13&quot;, &quot;31&quot; and &quot;33&quot; for the wild cluster bootstrap and &quot;11&quot; and &quot;31&quot; for the heteroskedastic bootstrap. For more information, see the details section. &quot;fnw11&quot; is the default for the cluster bootstrap, which runs a &quot;11&quot; type wild cluster bootstrap via the algorithm outlined in &quot;fast and wild&quot; (Roodman et al (2019)). &quot;11&quot; is the default for the heteroskedastic bootstrap.</span>
<span class="sd">        impose_null (bool): Controls if the null hypothesis is imposed on the bootstrap dgp or not. Null imposed (WCR) by default. If False, the null is not imposed (WCU)</span>
<span class="sd">        adj (bool, optional): Whether to adjust for small sample. Defaults to True.</span>
<span class="sd">        cluster_adj (bool, optional): Whether to do a cluster-robust small sample correction. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The output array of scores of shape kxG</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="n">bootstrap_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">=</span> <span class="s2">&quot;crv1&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span><span class="p">(</span><span class="n">adj</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
      <span class="k">if</span><span class="p">(</span><span class="n">cluster_adj</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">bootstrap_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">=</span> <span class="s2">&quot;crv3&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>

    <span class="n">bootstrap_type_x</span> <span class="o">=</span> <span class="n">bootstrap_type</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span>

    <span class="k">if</span> <span class="n">impose_null</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="o">=</span> <span class="s2">&quot;WCR&quot;</span> <span class="o">+</span> <span class="n">bootstrap_type_x</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="o">=</span> <span class="s2">&quot;WCU&quot;</span> <span class="o">+</span> <span class="n">bootstrap_type_x</span>

    <span class="c1"># not needed for all types, but compute anyways</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXy</span>

    <span class="c1"># precompute required objects for computing scores &amp; vcov&#39;s</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR3x&quot;</span><span class="p">]:</span> 

      <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
      <span class="n">X1</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
      <span class="n">X1_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">tX1gX1g_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">tX1gyg_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">tXgX1g_list</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">tX1X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
      <span class="n">tX1y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
        <span class="c1">#ix = g = 1</span>
        <span class="n">X1_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">==</span> <span class="n">g</span><span class="p">)])</span>
        <span class="n">tX1gX1g_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
        <span class="n">tX1gyg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
        <span class="n">tXgX1g_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span>  <span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
        <span class="n">tX1X1</span> <span class="o">=</span> <span class="n">tX1X1</span> <span class="o">+</span> <span class="n">tX1gX1g_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">tX1y</span> <span class="o">=</span> <span class="n">tX1y</span> <span class="o">+</span> <span class="n">tX1gyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

      <span class="n">beta_1g_tilde</span> <span class="o">=</span> <span class="p">[]</span>

      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
        <span class="n">beta_1g_tilde</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">tX1X1</span> <span class="o">-</span> <span class="n">tX1gX1g_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="p">(</span><span class="n">tX1y</span> <span class="o">-</span> <span class="n">tX1gyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>

      <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_1g_tilde</span>
      <span class="n">M</span> <span class="o">=</span> <span class="n">tXgX1g_list</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCU3x&quot;</span><span class="p">]:</span> 

      <span class="n">beta_g_hat</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
        <span class="n">beta_g_hat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXX</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>

      <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_g_hat</span>
      <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR1x&quot;</span><span class="p">]:</span> 

      <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
      <span class="n">beta_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_tilde</span>
      <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCU1x&quot;</span><span class="p">]:</span> 

      <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> 
      <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span>

    <span class="c1"># compute scores based on tXgyg, M, beta</span>
    <span class="n">scores_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR1x&quot;</span><span class="p">,</span> <span class="s2">&quot;WCU1x&quot;</span><span class="p">]):</span>

      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>

        <span class="n">scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">@</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR3x&quot;</span><span class="p">,</span> <span class="s2">&quot;WCU3x&quot;</span><span class="p">]):</span>

      <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>

        <span class="n">scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">@</span> <span class="n">beta</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))</span> <span class="c1"># k x G </span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span>


  <span class="k">def</span> <span class="nf">get_numer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   
      <span class="c1"># Calculate the bootstrap numerator</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Cg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">numer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cg</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>

  <span class="k">def</span> <span class="nf">get_denom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">==</span> <span class="s2">&quot;crv1&quot;</span><span class="p">:</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">))</span>

        <span class="c1"># numba optimization possible? </span>
        <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">ixh</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
            <span class="c1"># can be improved by replacing list calls with matrices; </span>
            <span class="n">H</span><span class="p">[</span><span class="n">ixg</span><span class="p">,</span><span class="n">ixh</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span><span class="p">[:,</span><span class="n">ixh</span><span class="p">]</span>

        <span class="c1"># now compute denominator</span>
        <span class="c1"># numba / cython / c++ optimization possible? Porting this part from </span>
        <span class="c1"># R to c++ gives good speed improvements</span>
        <span class="nd">@jit</span>
        <span class="k">def</span> <span class="nf">compute_denom</span><span class="p">(</span><span class="n">Cg</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">bootclustid</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">ssc</span><span class="p">):</span>

          <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

          <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">B</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">Zg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bootclustid</span><span class="p">):</span>
              <span class="n">vH</span> <span class="o">=</span> <span class="mi">0</span>
              <span class="k">for</span> <span class="n">ixh</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bootclustid</span><span class="p">):</span>
                <span class="n">vH</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">ixh</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">H</span><span class="p">[</span><span class="n">ixg</span><span class="p">,</span><span class="n">ixh</span><span class="p">]</span>
              <span class="n">Zg</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cg</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">ixg</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">vH</span>

            <span class="c1"># todo: ssc</span>
            <span class="n">denom</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">Zg</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

          <span class="k">return</span> <span class="n">denom</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="n">compute_denom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cg</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span><span class="p">)</span>

      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">==</span> <span class="s2">&quot;crv3&quot;</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inv_tXX_tXgXg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">inv_tXX_tXgXg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXX</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

          <span class="n">scores_g_boot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
          <span class="n">v_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span><span class="n">b</span><span class="p">]</span>

          <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>

            <span class="n">scores_g_boot</span><span class="p">[</span><span class="n">ixg</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span><span class="p">[:,</span><span class="n">ixg</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span>

          <span class="n">scores_boot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">scores_g_boot</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
          <span class="n">delta_b_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="n">scores_boot</span>

          <span class="n">delta_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>

          <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>

            <span class="n">score_diff</span> <span class="o">=</span> <span class="n">scores_boot</span> <span class="o">-</span> <span class="n">scores_g_boot</span><span class="p">[</span><span class="n">ixg</span><span class="p">,:]</span>
            <span class="n">delta_diff</span><span class="p">[</span><span class="n">ixg</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span>

              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_tXX_tXgXg</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span> <span class="o">@</span> <span class="n">score_diff</span> <span class="o">-</span> <span class="n">delta_b_star</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

              <span class="p">)</span>
          <span class="c1"># se&#39;s</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">delta_diff</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>


  <span class="k">def</span> <span class="nf">get_tboot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

      <span class="n">t_boot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numer</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">t_boot</span> <span class="o">=</span> <span class="n">t_boot</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="c1"># drop first element - might be useful for comp. of</span>

  <span class="k">def</span> <span class="nf">get_vcov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">==</span> <span class="s2">&quot;crv1&quot;</span><span class="p">:</span>

      <span class="n">meat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">])</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">X_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">]</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span><span class="p">)</span>
        <span class="n">meat</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">vcov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="n">meat</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">==</span> <span class="s2">&quot;crv3&quot;</span><span class="p">:</span> 

      <span class="c1"># calculate leave-one out beta hat</span>
      <span class="n">beta_jack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
        <span class="n">beta_jack</span><span class="p">[</span><span class="n">ixg</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span>
          <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXX</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">])</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXy</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">])</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_list</span><span class="p">[</span><span class="n">ixg</span><span class="p">])</span>
        <span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;beta_hat&quot;</span><span class="p">):</span>
        <span class="n">beta_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXy</span>

      <span class="n">beta_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span>

      <span class="n">vcov3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">ixg</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
        <span class="n">beta_centered</span> <span class="o">=</span> <span class="n">beta_jack</span><span class="p">[</span><span class="n">ixg</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">beta_center</span>
        <span class="n">vcov3</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">beta_centered</span><span class="p">,</span> <span class="n">beta_centered</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">vcov</span> <span class="o">=</span>  <span class="n">vcov3</span>


  <span class="k">def</span> <span class="nf">get_tstat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">se</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcov</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">))</span>
    <span class="n">t_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">/</span> <span class="n">se</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">t_stat</span> <span class="o">=</span> <span class="n">t_stats</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">get_pvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pval_type</span> <span class="o">=</span> <span class="s2">&quot;two-tailed&quot;</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">pval_type</span> <span class="o">==</span> <span class="s2">&quot;two-tailed&quot;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_boot</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">pval_type</span> <span class="o">==</span> <span class="s2">&quot;equal-tailed&quot;</span><span class="p">:</span>
      <span class="n">pl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stat</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_boot</span><span class="p">)</span>
      <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stat</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_boot</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pval_type</span> <span class="o">==</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stat</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_boot</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t_stat</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_boot</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="wildboottest.wildboottest.Wildboottest.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">bootcluster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Initializes the Wild Cluster Bootstrap Class</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>X</code></td>
        <td><code>Union[np.ndarray, pd.DataFrame, pd.Series]</code></td>
        <td><p>Exogeneous variable array or dataframe</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>Y</code></td>
        <td><code>Union[np.ndarray, pd.DataFrame, pd.Series]</code></td>
        <td><p>Endogenous variable array or dataframe</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>cluster</code></td>
        <td><code>Union[np.ndarray, pd.DataFrame, pd.Series]</code></td>
        <td><p>Cluster array or dataframe</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>R</code></td>
        <td><code>Union[np.ndarray, pd.DataFrame]</code></td>
        <td><p>Constraint matrix for running bootstrap</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>B</code></td>
        <td><code>int</code></td>
        <td><p>bootstrap iterations</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>bootcluster</code></td>
        <td><code>Union[np.ndarray, pd.DataFrame, pd.Series, None]</code></td>
        <td><p>Sub-cluster array. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>seed</code></td>
        <td><code>Union[int, None]</code></td>
        <td><p>Random seed for random weight types. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>TypeError</code></td>
        <td><p>Raise if input arrays are lists</p></td>
      </tr>
      <tr>
        <td><code>TestMatrixNonConformabilityException</code></td>
        <td><p>Raise if constraint matrix shape does not conform to X</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>wildboottest/wildboottest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> 
             <span class="n">Y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> 
             <span class="n">cluster</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> 
             <span class="n">R</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> 
             <span class="n">B</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
             <span class="n">bootcluster</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
             <span class="n">seed</span><span class="p">:</span>  <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Initializes the Wild Cluster Bootstrap Class</span>

<span class="sd">  Args:</span>
<span class="sd">      X (Union[np.ndarray, pd.DataFrame, pd.Series]): Exogeneous variable array or dataframe</span>
<span class="sd">      Y (Union[np.ndarray, pd.DataFrame, pd.Series]): Endogenous variable array or dataframe</span>
<span class="sd">      cluster (Union[np.ndarray, pd.DataFrame, pd.Series]): Cluster array or dataframe</span>
<span class="sd">      R (Union[np.ndarray, pd.DataFrame]): Constraint matrix for running bootstrap</span>
<span class="sd">      B (int): bootstrap iterations</span>
<span class="sd">      bootcluster (Union[np.ndarray, pd.DataFrame, pd.Series, None], optional): Sub-cluster array. Defaults to None.</span>
<span class="sd">      seed (Union[int, None], optional): Random seed for random weight types. Defaults to None.</span>

<span class="sd">  Raises:</span>
<span class="sd">      TypeError: Raise if input arrays are lists</span>
<span class="sd">      TestMatrixNonConformabilityException: Raise if constraint matrix shape does not conform to X</span>
<span class="sd">  &quot;&quot;&quot;</span>    

  <span class="s2">&quot;Initialize the wildboottest class&quot;</span>
  <span class="c1">#assert bootstrap_type in [&#39;11&#39;, &#39;13&#39;, &#39;31&#39;, &#39;33&#39;]</span>
  <span class="c1">#assert impose_null in [True, False]</span>

  <span class="k">if</span> <span class="n">bootcluster</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="n">bootcluster</span> <span class="o">=</span> <span class="n">cluster</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">bootcluster</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> cannot be a list&quot;</span><span class="p">)</span>

  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>

  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">values</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>

  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clustid</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">values</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bootcluster</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span> <span class="o">=</span> <span class="n">bootcluster</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">=</span> <span class="n">bootcluster</span><span class="o">.</span><span class="n">values</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clustid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">bootcluster</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">=</span> <span class="n">bootcluster</span>

  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">N_G_bootcluster</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">G</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clustid</span><span class="p">)</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>

  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="k">raise</span> <span class="n">TestMatrixNonConformabilityException</span><span class="p">(</span><span class="s2">&quot;The number of rows in the test matrix R, does not &quot;</span><span class="p">)</span>

  <span class="n">X_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">y_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">tXgXg_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">tXgyg_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">tXX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
  <span class="n">tXy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

  <span class="c1">#all_cluster = np.unique(bootcluster)</span>

  <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">:</span>

    <span class="c1"># split X and Y by (boot)cluster</span>
    <span class="n">X_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">==</span> <span class="n">g</span><span class="p">)]</span>
    <span class="n">Y_g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">==</span> <span class="n">g</span><span class="p">)]</span>
    <span class="n">tXgXg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X_g</span><span class="p">)</span> <span class="o">@</span> <span class="n">X_g</span>
    <span class="n">tXgyg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X_g</span><span class="p">)</span> <span class="o">@</span> <span class="n">Y_g</span>
    <span class="n">X_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_g</span><span class="p">)</span>
    <span class="n">y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_g</span><span class="p">)</span>
    <span class="n">tXgXg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tXgXg</span><span class="p">)</span>
    <span class="n">tXgyg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tXgyg</span><span class="p">)</span>
    <span class="n">tXX</span> <span class="o">=</span> <span class="n">tXX</span> <span class="o">+</span> <span class="n">tXgXg</span>
    <span class="n">tXy</span> <span class="o">=</span> <span class="n">tXy</span> <span class="o">+</span> <span class="n">tXgyg</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">X_list</span> <span class="o">=</span> <span class="n">X_list</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">Y_list</span> <span class="o">=</span> <span class="n">y_list</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span> <span class="o">=</span> <span class="n">tXgXg_list</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span> <span class="o">=</span> <span class="n">tXgyg_list</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">tXX</span> <span class="o">=</span> <span class="n">tXX</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">tXy</span> <span class="o">=</span> <span class="n">tXy</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">tXX</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">RtXXinv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="wildboottest.wildboottest.Wildboottest.get_scores" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bootstrap_type</span><span class="p">,</span> <span class="n">impose_null</span><span class="p">,</span> <span class="n">adj</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cluster_adj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Run bootstrap and get scores for each variable</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bootstrap_type</code></td>
        <td><code>str</code></td>
        <td><p>Determines which wild cluster bootstrap type should be run. Options are "fnw11","11", "13", "31" and "33" for the wild cluster bootstrap and "11" and "31" for the heteroskedastic bootstrap. For more information, see the details section. "fnw11" is the default for the cluster bootstrap, which runs a "11" type wild cluster bootstrap via the algorithm outlined in "fast and wild" (Roodman et al (2019)). "11" is the default for the heteroskedastic bootstrap.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>impose_null</code></td>
        <td><code>bool</code></td>
        <td><p>Controls if the null hypothesis is imposed on the bootstrap dgp or not. Null imposed (WCR) by default. If False, the null is not imposed (WCU)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>adj</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to adjust for small sample. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>cluster_adj</code></td>
        <td><code>bool</code></td>
        <td><p>Whether to do a cluster-robust small sample correction. Defaults to True.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>np.ndarray</code></td>
      <td><p>The output array of scores of shape kxG</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>wildboottest/wildboottest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bootstrap_type</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
               <span class="n">impose_null</span> <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">adj</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
               <span class="n">cluster_adj</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Run bootstrap and get scores for each variable</span>

<span class="sd">  Args:</span>
<span class="sd">      bootstrap_type (str): Determines which wild cluster bootstrap type should be run. Options are &quot;fnw11&quot;,&quot;11&quot;, &quot;13&quot;, &quot;31&quot; and &quot;33&quot; for the wild cluster bootstrap and &quot;11&quot; and &quot;31&quot; for the heteroskedastic bootstrap. For more information, see the details section. &quot;fnw11&quot; is the default for the cluster bootstrap, which runs a &quot;11&quot; type wild cluster bootstrap via the algorithm outlined in &quot;fast and wild&quot; (Roodman et al (2019)). &quot;11&quot; is the default for the heteroskedastic bootstrap.</span>
<span class="sd">      impose_null (bool): Controls if the null hypothesis is imposed on the bootstrap dgp or not. Null imposed (WCR) by default. If False, the null is not imposed (WCU)</span>
<span class="sd">      adj (bool, optional): Whether to adjust for small sample. Defaults to True.</span>
<span class="sd">      cluster_adj (bool, optional): Whether to do a cluster-robust small sample correction. Defaults to True.</span>

<span class="sd">  Returns:</span>
<span class="sd">      np.ndarray: The output array of scores of shape kxG</span>
<span class="sd">  &quot;&quot;&quot;</span>    

  <span class="k">if</span> <span class="n">bootstrap_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">=</span> <span class="s2">&quot;crv1&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span><span class="p">(</span><span class="n">adj</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cluster_adj</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">bootstrap_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crv_type</span> <span class="o">=</span> <span class="s2">&quot;crv3&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ssc</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>

  <span class="n">bootstrap_type_x</span> <span class="o">=</span> <span class="n">bootstrap_type</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span>

  <span class="k">if</span> <span class="n">impose_null</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="o">=</span> <span class="s2">&quot;WCR&quot;</span> <span class="o">+</span> <span class="n">bootstrap_type_x</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="o">=</span> <span class="s2">&quot;WCU&quot;</span> <span class="o">+</span> <span class="n">bootstrap_type_x</span>

  <span class="c1"># not needed for all types, but compute anyways</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXy</span>

  <span class="c1"># precompute required objects for computing scores &amp; vcov&#39;s</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR3x&quot;</span><span class="p">]:</span> 

    <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">X1_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tX1gX1g_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tX1gyg_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tXgX1g_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tX1X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">tX1y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
      <span class="c1">#ix = g = 1</span>
      <span class="n">X1_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootcluster</span> <span class="o">==</span> <span class="n">g</span><span class="p">)])</span>
      <span class="n">tX1gX1g_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
      <span class="n">tX1gyg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
      <span class="n">tXgX1g_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span>  <span class="n">X1_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
      <span class="n">tX1X1</span> <span class="o">=</span> <span class="n">tX1X1</span> <span class="o">+</span> <span class="n">tX1gX1g_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
      <span class="n">tX1y</span> <span class="o">=</span> <span class="n">tX1y</span> <span class="o">+</span> <span class="n">tX1gyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>

    <span class="n">beta_1g_tilde</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
      <span class="n">beta_1g_tilde</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">tX1X1</span> <span class="o">-</span> <span class="n">tX1gX1g_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="p">(</span><span class="n">tX1y</span> <span class="o">-</span> <span class="n">tX1gyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_1g_tilde</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">tXgX1g_list</span>

  <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCU3x&quot;</span><span class="p">]:</span> 

    <span class="n">beta_g_hat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>
      <span class="n">beta_g_hat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXX</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_g_hat</span>
    <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span>

  <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR1x&quot;</span><span class="p">]:</span> 

    <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
    <span class="n">beta_tilde</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXXinv</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">beta_tilde</span>
    <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span>

  <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCU1x&quot;</span><span class="p">]:</span> 

    <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_hat</span> 
    <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tXgXg_list</span>

  <span class="c1"># compute scores based on tXgyg, M, beta</span>
  <span class="n">scores_list</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR1x&quot;</span><span class="p">,</span> <span class="s2">&quot;WCU1x&quot;</span><span class="p">]):</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>

      <span class="n">scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">@</span> <span class="n">beta</span><span class="p">)</span>

  <span class="k">elif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootstrap_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WCR3x&quot;</span><span class="p">,</span> <span class="s2">&quot;WCU3x&quot;</span><span class="p">]):</span>

    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bootclustid</span><span class="p">):</span>

      <span class="n">scores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tXgyg_list</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">@</span> <span class="n">beta</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores_list</span><span class="p">))</span> <span class="c1"># k x G </span>

  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores_mat</span>
</code></pre></div>
        </details>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="wildboottest.wildboottest.Wildboottest.get_weights" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights_type</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Function for getting weights for bootstrapping.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>weights_type</code></td>
        <td><code>Tuple[str, Callable]</code></td>
        <td><p>The distribution to be used. Accepts Either 'rademacher', 'mammen', 'norm' or 'webb'. Optionally accepts a callable of one argument, <code>n</code>, the number of bootstraps iterations.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[np.ndarray, int]</code></td>
      <td><p>Returns the arrays of weights and the number of bootstrap iterations</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>wildboottest/wildboottest.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
  <span class="sd">&quot;&quot;&quot;Function for getting weights for bootstrapping.</span>

<span class="sd">  Args:</span>
<span class="sd">      weights_type (Tuple[str, Callable]): The distribution to be used. Accepts Either &#39;rademacher&#39;, &#39;mammen&#39;, &#39;norm&#39; or &#39;webb&#39;. Optionally accepts a callable of one argument, `n`, the number of bootstraps iterations.</span>

<span class="sd">  Returns:</span>
<span class="sd">      Tuple[np.ndarray, int]: Returns the arrays of weights and the number of bootstrap iterations</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="bp">self</span><span class="o">.</span><span class="n">weights_type</span> <span class="o">=</span> <span class="n">weights_type</span> 

  <span class="k">if</span> <span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">N_G_bootcluster</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="ow">and</span> <span class="n">weights_type</span><span class="o">==</span><span class="s1">&#39;rademacher&#39;</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_enumeration</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;2^G &lt; the number of boot iterations, setting full_enumeration to True.&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">full_enumeration</span> <span class="o">=</span> <span class="kc">False</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">draw_weights</span><span class="p">(</span>
    <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_type</span><span class="p">,</span> 
    <span class="n">full_enumeration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_enumeration</span><span class="p">,</span> 
    <span class="n">N_G_bootcluster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_G_bootcluster</span><span class="p">,</span>
    <span class="n">boot_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>
  <span class="p">)</span>  

  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 14, 2022</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 14, 2022</span>
      
    
  </small>
</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../weights/" class="md-footer__link md-footer__link--next" aria-label="Next: Weighting" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Weighting
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "content.code.annotate"], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>